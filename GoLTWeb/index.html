<!doctype html>
<html>
<head>
  <title>GoLTGen with WebGL shader</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <canvas id="game"></canvas>
<!-- <canvas id="debug"></canvas> -->

  <div class="control" id="settings">
    <h2>GoLTGen-Web</h2>
    <hr>
    <span><b>Board:&nbsp;</b></span>
    <span>Size X:&nbsp;
      <input id="xresolution" type="number" style="width: 50px" value="192" placeholder="192"/>
      &nbsp;px&nbsp;&nbsp;
    </span>
    <span>Size Y:&nbsp;
      <input id="yresolution" type="number" style="width: 50px" value="108" placeholder="108"/>
      &nbsp;px&nbsp;&nbsp;
    </span>
    <span>Array X:&nbsp;
      <input id="xmult" type="number" style="width: 40px" value="1" placeholder="1"/>
      &nbsp;&nbsp;
    </span>
    <span>Array Y:&nbsp;
      <input id="ymult" type="number" style="width: 40px" value="1" placeholder="1"/>
      &nbsp;&nbsp;
    </span>
    <br>
    <hr>
    <span><b>Game:&nbsp;</b></span>
    <span>Speed:&nbsp;
      <input id="interval" type="number" style="width: 40px" value="50" placeholder="50"/>
      &nbsp;fps&nbsp;&nbsp;
    </span>
    <br>
    <hr>
    <span><b>Start Condition:&nbsp;</b></span>
    <span>
      <select id="startCondition" style="width: 140px">
        <option value="squareSeed">Square</option>
        <option value="rectSeed">Rectangle</option>
        <option value="rectArraySeed">Rectangle Array</option>
        <option value="verticalBarSeed">Vertical Bars</option>
        <option value="horizontalBarSeed">Horizontal Bars</option>
        <option value="circleSeed">Circle</option>
        <option value="circleArraySeed">Circle Array</option>
        <option value="ovalSeed">Oval</option>
        <option value="ringSeed">Ring</option>
        <option value="crossSeed">Cross</option>
        <option value="randomBlobSeed">Random Blobs</option>
        <option value="randomSeed">Random</option>
      </select>
      &nbsp;&nbsp;
    </span>
    <span>Size:&nbsp;
      <input id="mod" type="number" style="width: 40px" value="5" placeholder="5"/>
      &nbsp;&nbsp;
    </span>
    <br>
    <hr>
    <span><b>Rules:&nbsp;</b></span>
    <span>Survive:&nbsp;
      <input id="survive" type="string" style="width: 90px" value="1, 2, 3, 4, 5" placeholder="1-9"/>
      &nbsp;&nbsp;
    </span>
    <span>Birth:&nbsp;
      <input id="birth" type="string" style="width: 90px" value="3" placeholder="1-9"/>
      &nbsp;&nbsp;
    </span>
    <span>Natural&nbsp;Death&nbsp;at:&nbsp;
      <input id="ndeath" type="number" style="width: 60px" value="200" placeholder="0-255"/>
      &nbsp;iterations&nbsp;&nbsp;
    </span>
    <br>
    <hr>
    <span><b>Colors:&nbsp;</b></span>
    <span>Palette:
      <select id="colormap" style="width: 120px">
        <option value=Accent>Accent</option>
        <option value=Blues>Blues</option>
        <option value=BrBG>BrBG</option>
        <option value=BuGn>BuGn</option>
        <option value=BuPu>BuPu</option>
        <option value=CMRmap>CMRmap</option>
        <option value=Dark2>Dark2</option>
        <option value=GnBu>GnBu</option>
        <option value=Greens>Greens</option>
        <option value=Greys>Greys</option>
        <option value=OrRd>OrRd</option>
        <option value=Oranges>Oranges</option>
        <option value=PRGn>PRGn</option>
        <option value=Paired>Paired</option>
        <option value=Pastel1>Pastel1</option>
        <option value=Pastel2>Pastel2</option>
        <option value=PiYG>PiYG</option>
        <option value=PuBu>PuBu</option>
        <option value=PuBuGn>PuBuGn</option>
        <option value=PuOr>PuOr</option>
        <option value=PuRd>PuRd</option>
        <option value=Purples>Purples</option>
        <option value=RdBu>RdBu</option>
        <option value=RdGy>RdGy</option>
        <option value=RdPu>RdPu</option>
        <option value=RdYlBu>RdYlBu</option>
        <option value=RdYlGn>RdYlGn</option>
        <option value=Reds>Reds</option>
        <option value=Set1>Set1</option>
        <option value=Set2>Set2</option>
        <option value=Set3>Set3</option>
        <option value=Spectral>Spectral</option>
        <option value=Wistia>Wistia</option>
        <option value=YlGn>YlGn</option>
        <option value=YlGnBu>YlGnBu</option>
        <option value=YlOrBr>YlOrBr</option>
        <option value=YlOrRd>YlOrRd</option>
        <option value=afmhot>afmhot</option>
        <option value=autumn>autumn</option>
        <option value=binary>binary</option>
        <option value=bone>bone</option>
        <option value=brg>brg</option>
        <option value=bwr>bwr</option>
        <option value=cividis>cividis</option>
        <option value=cool>cool</option>
        <option value=coolwarm>coolwarm</option>
        <option value=copper>copper</option>
        <option value=cubehelix>cubehelix</option>
        <option value=flag>flag</option>
        <option value=gist_earth>gist_earth</option>
        <option value=gist_gray>gist_gray</option>
        <option value=gist_heat>gist_heat</option>
        <option value=gist_ncar>gist_ncar</option>
        <option value=gist_rainbow>gist_rainbow</option>
        <option value=gist_stern>gist_stern</option>
        <option value=gist_yarg>gist_yarg</option>
        <option value=gnuplot>gnuplot</option>
        <option value=gnuplot2>gnuplot2</option>
        <option value=gray>gray</option>
        <option value=hot>hot</option>
        <option value=hsv>hsv</option>
        <option value=inferno>inferno</option>
        <option value=jet>jet</option>
        <option value=magma>magma</option>
        <option value=nipy_spectral>nipy_spectral</option>
        <option value=ocean>ocean</option>
        <option value=pink>pink</option>
        <option value=plasma>plasma</option>
        <option value=prism>prism</option>
        <option value=rainbow>rainbow</option>
        <option value=seismic>seismic</option>
        <option value=spring>spring</option>
        <option value=summer>summer</option>
        <option value=tab10>tab10</option>
        <option value=tab20>tab20</option>
        <option value=tab20b>tab20b</option>
        <option value=tab20c>tab20c</option>
        <option value=terrain>terrain</option>
        <option value=turbo>turbo</option>
        <option value=twilight>twilight</option>
        <option value=twilight_shifted>twilight_shifted</option>
        <option value=viridis>viridis</option>
        <option value=winter>winter</option>
      </select>&nbsp;&nbsp;
    </span>
    <span>Reverse:&nbsp;
      <input id="reverse" style="width: 15px; height: 15px;" type="checkbox" checked/>
      &nbsp;&nbsp;
    </span>
    <span>Start (age):&nbsp;
      <input id="colorStart" type="number" style="width: 50px" value="0" placeholder="0"/>
      &nbsp;%&nbsp;&nbsp;
    </span>
    <span><b><</b>&nbsp;&nbsp;</span>
    <span>Stop (age):&nbsp;
      <input id="colorStop" type="number" style="width: 50px" value="100" placeholder="100"/>
      &nbsp;%&nbsp;&nbsp;
    </span>
    <br style="margin-top:25px;">
    <button id="createGame"><b>Create Game</b></button>
  </div>
   
  <div class="control" id="info">
    <button id="prev">prev</button>
    <button id="pause">pause</button>
    <button id="play">play</button>
    <button id="next">next</button>
    <span id="timer" style="width: 120px; display: inline-block;">&nbsp;</span>
    <span id="generation">&nbsp;</span>
<!--
   <label>
      <input id="render-active" type="checkbox" checked autocomplete="off"> active
    </label>
    <label>
      <input id="render-age" type="checkbox" checked autocomplete="off"> age
    </label>
    <label>
      <input id="render-neighbours" type="checkbox" checked autocomplete="off"> neighbours
    </label>
-->
    <div id="info">&nbsp;</div>
    <br>
    <span style="font-size: 14px;">press <kbd>h</kbd> to hide this menu </span>
  </div>

  <script src="utils.js"></script>
  <script src="js-colormaps.js"></script>
  <script src="debug-viewer.js"></script>
  <script src="viewer.js"></script>
  <script src="ca.js"></script>
  <script>
    window.onload = function() {
      const canvas = document.querySelector('#game');
      //const debug = document.querySelector('#debug');
      let playing = false;

      document.querySelector('#createGame').onclick = () => {
        const x = document.querySelector('#xresolution').value;
        const y = document.querySelector('#yresolution').value;
        const mx = document.querySelector('#xmult').value;
        const my = document.querySelector('#ymult').value;

        const birth = document.querySelector('#birth').value.split(',').map(function(item) {
            return parseInt(item, 10);
        });
        const survive = document.querySelector('#survive').value.split(',').map(function(item) {
            return parseInt(item, 10);
        });
        const ndeath = Math.max(Math.min(document.querySelector('#ndeath').value, 255), 0);

        const colormap = document.querySelector('#colormap').value;
        const reverse = document.querySelector('#reverse').checked;

        const startCondition = document.querySelector('#startCondition').value;
        const mod = document.querySelector('#mod').value;

        const colorStart = Math.max(document.querySelector('#colorStart').value*2.55, 0);
        const colorStop = Math.min(document.querySelector('#colorStop').value*2.55, 255);

        const offscreen = new OffscreenCanvas(x, y);

        const ca = new CellularAutomaton(x, y, survive, birth, ndeath, 40, eval(startCondition), mod);
        const viewer = new Viewer(offscreen, ca, colormap, reverse, mx, my, colorStart, colorStop);

        //const dbgViewer = new DebugViewer(debug, offscreen, ca);

        const generationCount = document.querySelector('#generation');
        ca.onGenerationChanged = (generation) => {
          generationCount.innerHTML = generation;
          const avg = Math.round((1/(viewer.total_duration/generation))*1000);
          timer.innerHTML = `${avg} (${Math.round(1/viewer.last_render_duration*1000)})`;
        };

        const interval = document.querySelector('#interval');

        window.viewer = viewer;
        viewer.render();

        //window.dbgViewer = dbgViewer;
        //dbgViewer.render();

        document.getElementById("settings").style.display="none";
        document.getElementById("info").style.display="block";
      }

      document.querySelector('#prev').onclick = () => viewer.prev();
      document.querySelector('#next').onclick = () => viewer.next();
      document.querySelector('#play').onclick = () => {
        playing = true;
        viewer.play(Math.round(1/parseInt(interval.value)*1000));
      }
      document.querySelector('#pause').onclick = () => {
        playing = false;
        viewer.pause();
      }

      window.onkeydown = function(event) {
        if (event.keyCode == 32) {
          event.preventDefault();
          if(document.getElementById("settings").style.display===""){
            document.querySelector('#createGame').click();
          } else {
            if(playing===false){
              document.querySelector('#play').click();
            } else {
              document.querySelector('#pause').click(); 
            }
          }
        } else if (event.keyCode == 37) {
          document.querySelector('#prev').click()
        } else if (event.keyCode == 39) {
          document.querySelector('#next').click()
        }else if (event.keyCode == 72) {
          if(document.getElementById("info").style.display==="block"){
            document.getElementById("info").style.display="none"
          } else {
            document.getElementById("info").style.display="block"
          }
        };
      };
      
      //document.querySelector('#render-active').onchange = (e) => viewer.setRenderActive(e.target.checked);
      //document.querySelector('#render-age').onchange = (e) => viewer.setRenderAge(e.target.checked);
      //document.querySelector('#render-neighbours').onchange = (e) => viewer.setRenderNeighbours(e.target.checked);
      /*
      canvas.onclick = (e) => {
        const rect = e.target.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const board_x = Math.floor(x / rect.width * ca.width);
        const board_y = Math.floor(y / rect.height * ca.height);
        const info = ca.getCell(board_x, board_y);
        document.getElementById('info').innerHTML = `
            x: ${board_x}, 
            y: ${board_y}, 
            active: ${info.active ? 'yes' : 'no'},
            age: ${info.age},
            neighbours: ${info.neighbours}`;
      }
      */
    }
  </script>
</body>
</html>
